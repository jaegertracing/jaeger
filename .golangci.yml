version: "2"
run:
  go: "1.23"
linters:
  enable:
    - asciicheck
    - bidichk
    - bodyclose
    - contextcheck
    - copyloopvar
    - decorder
    - depguard
    - durationcheck
    - errname
    - errorlint
    - gocritic
    - gosec
    - misspell
    - nakedret
    - nilerr
    - noctx
    - nolintlint
    - perfsprint
    - revive
    - testifylint
    - usestdlibvars

    # TODO consider adding more linters, cf. https://olegk.dev/go-linters-configuration-the-right-version

linters-settings:
  depguard:
    rules:
      disallowed-deps:
        deny:
          - pkg: go.uber.org/atomic
            desc: "Use 'sync/atomic' instead of go.uber.org/atomic"
          - pkg: io/ioutil
            desc: "Use os or io instead of io/ioutil"
          - pkg: github.com/hashicorp/go-multierror
            desc: "Use errors.Join instead of github.com/hashicorp/go-multierror"
          - pkg: go.uber.org/multierr
            desc: "Use errors.Join instead of github.com/hashicorp/go-multierror"
          - pkg: "github.com/jaegertracing/jaeger/model$"
            desc: "Use github.com/jaegertracing/jaeger-idl/model/v1"
          - pkg: "github.com/jaegertracing/jaeger/internal/proto-gen/api_v2$"
            desc: "Use github.com/jaegertracing/jaeger-idl/proto-gen/api_v2"
      # crossdock-go provides assert/require similar to stretchr/testify
      # but we never want to use them outside of the crossdock tests.
      disallow-crossdock:
        deny:
          - pkg: github.com/crossdock/crossdock-go
            desc: "Do not refer to crossdock from other packages"
        files:
          - "!**/crossdock/**"

      disallow-uber/goleak:
        deny:
         - pkg: go.uber.org/goleak
           desc: "Use github.com/jaegertracing/jaeger/internal/testutils"
        files:
          - "**_test.go"

      disallow-otel-contrib-translator:
        deny:
          - pkg: github.com/open-telemetry/opentelemetry-collector-contrib/pkg/translator/jaeger
            desc: "Use v1adapter package instead of opentelemetry-collector-contrib/pkg/translator/jaeger"
        files:
          - "!**/v1adapter/**"

  goimports:
    local-prefixes: github.com/jaegertracing/jaeger
  gosec:
    # To specify a set of rules to explicitly exclude.
    # Available rules: https://github.com/securego/gosec#available-rules
    excludes:
      - G104
      - G107
      - G404
      - G601
  govet:
    enable-all: true
    disable:
      # There is rarely performance differences due to padding,
      # the most noticable impact is memory usage. However,
      # the main trace data is Protobuf-generated and we ignore
      # those files from linting, so this linter is not useful.
      - fieldalignment
      # Disable shadow
      - shadow
  perfsprint:
    # Optimizes even if it requires an int or uint type cast.
    int-conversion: true
    # Optimizes into `err.Error()` even if it is only equivalent for non-nil errors.
    err-error: true
    # Optimizes `fmt.Errorf`.
    errorf: true
    # Optimizes `fmt.Sprintf` with only one argument.
    sprintf1: true
    # Optimizes into strings concatenation.
    strconcat: true
  revive:
      ignore-generated-header: true
      severity: error
      enable-all-rules: true
      rules:
        - name: line-length-limit
          arguments:
            - 80
          disabled: true
        - name: add-constant
          disabled: true
        - name: cognitive-complexity
          disabled: true
        - name: cyclomatic
          disabled: true
        - name: var-naming
          disabled: true
        - name: unchecked-type-assertion
          disabled: true
        - name: max-public-structs
          disabled: true
        - name: unhandled-error
          disabled: true
        - name: flag-parameter
          disabled: true
        - name: confusing-naming
          disabled: true
        - name: function-length
          disabled: true
        - name: argument-limit
          disabled: true
        - name: import-alias-naming
          disabled: true
        - name: get-return
          disabled: true
        - name: range-val-address
          disabled: true
        - name: var-declaration
          disabled: true
        - name: nested-structs
          disabled: true
        - name: deep-exit
          disabled: true
        - name: comment-spacings
          disabled: true
    testifylint:
      enable-all: true
  exclusions:
    generated: lax
    presets:
      - comments
      - common-false-positives
      - legacy
      - std-error-handling
    rules:
      - linters:
          - bodyclose
          - gosec
          - noctx
        path: _test\.go
      - linters:
          - noctx
        path: crossdock
      - linters:
          - staticcheck
        path: internal/grpctest/
      - linters:
          - gocritic
        text: dupArg
      - linters:
          - gocritic
        text: exitAfterDefer
      - linters:
          - gocritic
        text: appendAssign
    paths:
      - .*.pb.go$
      - mocks
      - thrift-0.9.2
      - .*-gen
issues:
  max-issues-per-linter: 0
  max-same-issues: 0
formatters:
  enable:
    - gofmt
    - gofumpt
    - goimports
  settings:
    goimports:
      local-prefixes:
        - github.com/jaegertracing/jaeger
  exclusions:
    generated: lax
    paths:
      - .*.pb.go$
      - mocks
      - thrift-0.9.2
      - .*-gen
