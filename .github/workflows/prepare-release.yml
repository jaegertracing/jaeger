# Re-indexing trigger
name: Prepare Release

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'The new version tag (e.g., v1.42.0)'
        required: true

jobs:
  prepare_release_pr:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v4
        with:
          # Fetch all history so the changelog can be generated correctly
          fetch-depth: 0

      - name: Run Release Prep Script
        run: |
          chmod +x ./scripts/release/prepare-release.sh
          ./scripts/release/prepare-release.sh ${{ github.event.inputs.version }}

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore(release): Prepare release ${{ github.event.inputs.version }}"
          title: "Prepare Release ${{ github.event.inputs.version }}"
          body: |
            This PR was automatically created to prepare for the `${{ github.event.inputs.version }}` release.

            It includes:
            - Updated CHANGELOG.md
            - Updated Jaeger UI version

            Fixes #7496
          branch: "chore/prepare-release-${{ github.event.inputs.version }}"
          delete-branch: true